<!doctype html>
<html>
  <head>
    <link
      rel="stylesheet"
      href="https://fonts.googleapis.com/css?family=VT323&display=swap"
    />
    <link rel="stylesheet" href="game_2.css" />
    <title>Simple Snake Game</title>
  </head>

  <body>
    <canvas id="game" width="300" height="300"></canvas>
    <script>
      let gameMainAudio = new Audio("../../audio/themesong.mp3");
      let deathAudio = new Audio("../../audio/error.wav");
      const gulpSound = new Audio("../../audio/gulp.mp3");

      // Initialize game variables
      var canvas = document.getElementById("game");
      var ctx = canvas.getContext("2d");
      var snake = [{ x: 150, y: 150 }]; // starting position of snake
      var direction = "right"; // starting direction of snake
      var food = { x: 0, y: 0 }; // starting position of food
      var score = 0;
      var highScore = 0;
      var gameStarted = false; // variable to track if the game has started

      // Draw the snake on the canvas
      function drawSnake() {
        ctx.fillStyle = "blue";
        for (var i = 0; i < snake.length; i++) {
          ctx.fillRect(snake[i].x, snake[i].y, 10, 10);
        }
      }

      // Generate random position for food
      function generateFood() {
        food.x = Math.floor(Math.random() * 29) * 10;
        food.y = Math.floor(Math.random() * 29) * 10;
      }

      // Draw the food on the canvas
      function drawFood() {
        ctx.fillStyle = "red";
        ctx.fillRect(food.x, food.y, 10, 10);
      }

      // Move the snake in the current direction
      function moveSnake() {
        var nextX = snake[0].x;
        var nextY = snake[0].y;
        switch (direction) {
          case "right":
            nextX += 10;
            break;
          case "left":
            nextX -= 10;
            break;
          case "up":
            nextY -= 10;
            break;
          case "down":
            nextY += 10;
            break;
        }
        // Add the new position to the beginning of the snake and remove the last element
        snake.unshift({ x: nextX, y: nextY });
        snake.pop();
      }

      // Check if the snake has collided with the edges of the canvas
      function checkCollision() {
        if (
          snake[0].x < 0 ||
          snake[0].x > 300 ||
          snake[0].y < 0 ||
          snake[0].y > 300
        ) {
          gameOver();
        }
      }

      // Check if the snake has collided with its own body
      function checkSelfCollision() {
        for (var i = 1; i < snake.length; i++) {
          if (snake[0].x === snake[i].x && snake[0].y === snake[i].y) {
            gameOver();
          }
        }
      }

      // Check if the snake has eaten the food
      function checkFoodCollision() {
        if (snake[0].x === food.x && snake[0].y === food.y) {
          score++;
          gulpSound.play();

          generateFood();
          snake.push({
            x: snake[snake.length - 1].x,
            y: snake[snake.length - 1].y,
          });
        }
      }

      // End the game and display the score
      function gameOver() {
        deathAudio.play();
        clearInterval(gameInterval);
        ctx.clearRect(0, 0, 300, 300); // clear the canvas
        ctx.fillStyle = "black";
        ctx.fillRect(0, 0, canvas.width, canvas.height);
        ctx.fillStyle = "white";
        ctx.font = "30px 'VT323', monospaced"; // Use VT323 here

        ctx.fillText("Score: " + score, 110, 100);

        if (score > highScore) {
          highScore = score;
        }

        ctx.fillText("High Score: " + highScore, 75, 160);

        // Create and style the restart button
        ctx.fillStyle = "green";
        ctx.fillRect(100, 200, 100, 40);
        ctx.fillStyle = "white";
        ctx.font = "20px 'VT323', monospaced";
        ctx.fillText("Restart", 120, 225);

        // Listen for click event on the restart button
        canvas.addEventListener("click", restartGame);
      }

      // Function to restart the game
      function restartGame() {
        // Reset game variables
        snake = [{ x: 150, y: 150 }];
        direction = "right";
        food = { x: 0, y: 0 };
        score = 0;

        // Clear the canvas
        ctx.clearRect(0, 0, 300, 300);

        // Remove the event listener to avoid multiple listeners
        canvas.removeEventListener("click", restartGame);

        // Start the game again
        generateFood();
        gameInterval = setInterval(gameLoop, 100);
      }
      // Main game loop
      function gameLoop() {
        ctx.clearRect(0, 0, 300, 300); // clear the canvas
        ctx.fillStyle = "black";
        ctx.fillRect(0, 0, canvas.width, canvas.height);
        drawSnake();
        drawFood();
        moveSnake();
        checkCollision();
        checkSelfCollision();
        checkFoodCollision();
      }

      // Start the game
      generateFood();
      var gameInterval = setInterval(gameLoop, 100); // run the game loop every 100 milliseconds

      // Listen for key presses to change the direction of the snake
      document.onkeydown = function (event) {
        switch (event.keyCode) {
          case 37:
            if (direction !== "right") {
              direction = "left";
            }
            break;
          case 68:
            if (direction !== "left") {
              direction = "right";
            }
            break;
          case 38:
            if (direction !== "down") {
              direction = "up";
            }
            break;
          case 83:
            if (direction !== "up") {
              direction = "down";
            }
            break;
          case 39:
            if (direction !== "left") {
              direction = "right";
            }
            break;
          case 65:
            if (direction !== "right") {
              direction = "left";
            }
            break;
          case 40:
            if (direction !== "up") {
              direction = "down";
            }
            break;
          case 87:
            if (direction !== "down") {
              direction = "up";
            }
            break;
        }
      };
    </script>
  </body>
</html>
